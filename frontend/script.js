const API='http://localhost:5000/api';let action,cmd;document.addEventListener('DOMContentLoaded',()=>{checkStatus();setInterval(checkStatus,5e3);document.getElementById('validateBtn').onclick=()=>validate();document.getElementById('infoBtn').onclick=()=>info();document.getElementById('executeBtn').onclick=()=>showModal();document.getElementById('confirmYes').onclick=()=>execute();document.getElementById('confirmNo').onclick=()=>hideModal();document.getElementById('clearLogsBtn').onclick=()=>clearLogs()});async function checkStatus(){try{const r=await fetch(API+'/status');const d=await r.json();document.getElementById('status').innerHTML='✅ Online';document.getElementById('status').style.color='green'}catch{document.getElementById('status').innerHTML='❌ Offline';document.getElementById('status').style.color='red'}}function validate(){action=document.getElementById('actionType').value;cmd=document.getElementById('command').value;if(!action||!cmd)return alert('Fill all fields');fetch(API+'/validate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,command:cmd})}).then(r=>r.json()).then(d=>{if(d.allowed){document.getElementById('resultBox').innerHTML='✅ Allowed';document.getElementById('executeBtn').disabled=false}else{document.getElementById('resultBox').innerHTML='❌ '+d.reason;document.getElementById('executeBtn').disabled=true}})}async function info(){action=document.getElementById('actionType').value;if(!action)return;const r=await fetch(API+'/info',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,command:document.getElementById('command').value})});const d=await r.json();let h=`<b>${d.action}</b><br><br>${d.description}<br><br><b>Risks:</b><ul>`;d.risks.forEach(r=>{h+=`<li>⚠️ ${r}</li>`});document.getElementById('infoBox').innerHTML=h}function showModal(){document.getElementById('confirmText').textContent=`Execute ${action}?`;document.getElementById('commandPreview').textContent=cmd.substring(0,200);document.getElementById('confirmModal').classList.add('active')}function hideModal(){document.getElementById('confirmModal').classList.remove('active')}async function execute(){try{const r=await fetch(API+'/execute',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,command:cmd,confirmed:true})});const d=await r.json();hideModal();if(d.success){document.getElementById('resultBox').innerHTML='✅ Success!';log(`✓ ${action} done`)}else{document.getElementById('resultBox').innerHTML=`❌ ${d.error}`;log(`✗ Failed: ${d.error}`)}}catch(e){log(`✗ Error: ${e}`)}}function log(m){const l=document.getElementById('logsBox');const t=new Date().toLocaleTimeString();l.innerHTML=`[${t}] ${m}<br>`+l.innerHTML}function clearLogs(){document.getElementById('logsBox').innerHTML=''}
